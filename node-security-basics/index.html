<!doctype html><html lang="en"><head><meta charset="utf-8"><title>Node.js security basics</title><meta name="viewport" content="width=device-width,initial-scale=1"></head><body><style>.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#333;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body a{background-color:transparent;-webkit-text-decoration-skip:objects}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body strong{font-weight:inherit;font-weight:bolder}.markdown-body h1{font-size:2em;margin:.67em 0}.markdown-body img{border-style:none}.markdown-body code{font-family:monospace,monospace;font-size:1em}.markdown-body *{box-sizing:border-box}.markdown-body a{color:#4078c0;text-decoration:none}.markdown-body a:active,.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body h1,.markdown-body h2{margin-top:0;margin-bottom:0}.markdown-body h1{font-size:32px;font-weight:600}.markdown-body h2{font-size:24px;font-weight:600}.markdown-body p{margin-top:0;margin-bottom:10px}.markdown-body code{font-family:Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body p{margin-top:0;margin-bottom:16px}.markdown-body h1,.markdown-body h2{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eee}.markdown-body h2{font-size:1.5em}.markdown-body img{max-width:100%;box-sizing:content-box;background-color:#fff}.markdown-body code{padding:0;padding-top:.2em;padding-bottom:.2em;margin:0;font-size:85%;background-color:rgba(0,0,0,.04);border-radius:3px}.markdown-body code:after,.markdown-body code:before{letter-spacing:-.2em;content:"\A0"}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#4078c0;border:1px solid #4078c0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto;padding:45px}@media screen and (max-width:480px){.markdown-body{padding:15px}}.markdown-body .heading-anchor{color:inherit}</style><article class="markdown-body"><h1>Node.js security basics</h1><p><a href="https://csabapalfi.github.io">Csaba Palfi</a>, Sep 2014</p><p><strong>Node is not different.</strong> All <strong>humans writing code are an un-patched vulnerability</strong>. There will always be vulnerabilities but what matters is your <strong>process</strong> dealing with them. Learn, fix, repeat. Here are some basic tips:</p><h2><a class="heading-anchor" name="1-know-owasp-top-10" href="#1-know-owasp-top-10">1. know OWASP Top 10</a></h2><p><a href="https://www.owasp.org/index.php/Top_10_2013-Top_10">OWASP top 10</a> is list of the <strong>most critical</strong> and prevalent web application <strong>security issues</strong>. It&apos;s a great way to get started.</p><p><a href="https://github.com/OWASP/NodeGoat">NodeGoat</a> is an express webapp with Mongo <strong>demonstrating</strong> OWASP Top 10 issues and addressing them. Any volunteers to write one for <a href="http://hapijs.com/">hapi</a>?</p><h2><a class="heading-anchor" name="2-use-security-headers" href="#2-use-security-headers">2. use security headers</a></h2><p>Utilizing <strong>security HTTP headers can greatly improve security</strong>. Learn about these and use them!</p><p>NodeGoat uses the <a href="https://www.npmjs.org/package/helmet">helmet</a> express middlewares for this. <a href="https://www.npmjs.org/package/lusca">lusca</a> is another good express middleware.</p><p>Hapi supports a lot of these headers out of the box.</p><h2><a class="heading-anchor" name="3-code-require-code-responsibly" href="#3-code-require-code-responsibly">3. <code>require</code> responsibly</a></h2><p>You&apos;re responsible for the modules you <code>require</code>. Do you at least check number of installs on npm? Do you check open issues on Github?</p><p>The <a href="https://nodesecurity.io/">node security project</a> maintains a list of <strong>known vulnerabilities for npm modules</strong>. They provide a <a href="https://www.npmjs.org/package/nsp">command line tool</a>, Grunt task, an API (<a href="https://nodesecurity.io/validate/crumb/2.0.0">example</a>). Closer integration with npm is coming as well.</p><h2><a class="heading-anchor" name="4-never-trust-user-input" href="#4-never-trust-user-input">4. never trust user input</a></h2><p>It&apos;s so easy to forget that users don&apos;t always <a href="http://xkcd.com/327/">mean well</a>. <strong>Always validate request params and body</strong> instead of just building mongo queries based on them.</p><p>In express make sure you understand the simple and extended queryparser and bodyParser.urlencoded options.</p><p>With hapi make sure you check out <a href="https://github.com/hapijs/joi">joi</a> - their amazing <strong>declarative validation</strong> module.</p><p>Node.js services sometimes just proxy through other backends. Make sure you only pass validated input through.</p><h2><a class="heading-anchor" name="5-prevent-command-injection" href="#5-prevent-command-injection">5. prevent command injection</a></h2><p>The <code>exec</code> method in the <a href="http://nodejs.org/api/child_process.html">child_process</a> can be dangerous as it gets it&apos;s whole command as a String. If the wrong thing get concatenated in there it&apos;ll hurt. Just make sure you use <strong><code>execFile</code> or <code>spawn</code></strong> instead as <strong>they get arguments as an array</strong>. Read <a href="https://blog.liftsecurity.io/2014/08/19/Avoid-Command-Injection-Node.js">this post</a> to learn more.</p><h2><a class="heading-anchor" name="6-do-crypto-well" href="#6-do-crypto-well">6. do crypto well</a></h2><p>Watch out for cases when <strong>depcrypting garbage doesn&apos;t throw error</strong>. Have tests for these scenarios.</p><p>Actually, <strong>just use HMAC</strong> but watch out for timing attacks. (<a href="https://github.com/hapijs/cryptiles">cryptiles</a> from the hapi guys has <code>fixedTimeComparison</code> to prevent that)</p><p>Checkout <a href="http://cryptopals.com/">cryptopals.com</a> if you want to deeply understand crypto.</p><h2><a class="heading-anchor" name="update-more-security-tips" href="#update-more-security-tips">UPDATE: More security tips</a></h2><p>Some <a href="http://blog.risingstack.com/node-js-security-tips/">more security tips</a> were published by <a href="http://twitter.com/nthgergo">Gergely Nemeth</a> of <a href="http://risingstack.com">RisingStack</a>.</p><h2><a class="heading-anchor" name="thanks" href="#thanks">Thanks</a></h2><p><a href="https://twitter.com/adam_baldwin">Adam Baldwin</a> (from <a href="http://liftsecurity.io">^Lift</a>), his two talks at <a href="http://lnug.org/">LNUG</a> and <a href="http://attending.io/events/node-security-project-meetup">London Node Security Meetup</a> inspired this post.</p><p><img src="https://ga-beacon.appspot.com/UA-29212656-1/node-security-basics?pixel" alt=""></p></article></body></html>