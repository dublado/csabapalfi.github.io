<!doctype html><html lang="en"><head><meta charset="utf-8"><title>&#x1F4F1; Reactive programming and message buses for mobile</title><meta name="viewport" content="width=device-width,initial-scale=1"></head><body><style>.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#333;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body a{background-color:transparent;-webkit-text-decoration-skip:objects}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body strong{font-weight:inherit;font-weight:bolder}.markdown-body h1{font-size:2em;margin:.67em 0}.markdown-body img{border-style:none}.markdown-body *{box-sizing:border-box}.markdown-body a{color:#4078c0;text-decoration:none}.markdown-body a:active,.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body h1,.markdown-body h2{margin-top:0;margin-bottom:0}.markdown-body h1{font-size:32px;font-weight:600}.markdown-body h2{font-size:24px;font-weight:600}.markdown-body p{margin-top:0;margin-bottom:10px}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body p{margin-top:0;margin-bottom:16px}.markdown-body h1,.markdown-body h2{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eee}.markdown-body h2{font-size:1.5em}.markdown-body img{max-width:100%;box-sizing:content-box;background-color:#fff}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#4078c0;border:1px solid #4078c0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto;padding:45px}@media screen and (max-width:480px){.markdown-body{padding:15px}}.markdown-body .heading-anchor{color:inherit}</style><article class="markdown-body"><h1>&#x1F4F1; Reactive programming and message buses for mobile</h1><p><a href="https://csabapalfi.github.io">Csaba Palfi</a>, Jan 2014</p><p>I attended a <a href="http://www.meetup.com/mobile_web/events/156458162/">Mobile Web Meetup</a> yesterday organized by Matt Pearce from Cognizant.</p><p><strong>Maciej Matyjas (<a href="https://twitter.com/matyjas">@matyjas</a>)</strong> talked about reactive programming and message buses for mobile. He is the <strong>mobile tech lead for Hotels.com</strong> (yes, I work there, too). Maciej is in an especially good position to react (pun intended) to the <strong>convergence of mobile and functional programming</strong> since he has more than 10 years of experience in mobile and also an active member of the Scala community in London. It was a fun talk with lot of example code and photos of buses.</p><h2><a class="heading-anchor" name="motivations-to-go-reactive-or-use-buses" href="#motivations-to-go-reactive-or-use-buses">Motivations to go reactive or use buses</a></h2><p>Mobile development has been around for a while so what&apos;s the main motivation behind looking for new approaches?</p><p>One of the key drivers is making our apps <strong>more aware of the user&apos;s context</strong> to improve user experience. Maciej mentioned things like connection type, battery, location, sensors or even something as simple like the time of the day. A good example is not starting to download a lot of data on 3G or using the time of the day to guess if a customer is looking for business or family hotels.</p><p>Another reason is how <strong>async is more natural</strong> in a lot of cases on a mobile device. Why waste valuable battery life polling for updates if you can react on events pushed to you. <strong>Mobile &#x2764; async</strong>.</p><p>You can also think about <strong>realtime</strong> updates like displaying likes, comments as they happen and how to handle these in your app.</p><p><strong>Utilizing multicore</strong> is also becoming more important as even entry level Android devices have at least two cores these days.</p><h2><a class="heading-anchor" name="message-buses" href="#message-buses">Message buses</a></h2><p>The idea of message buses has been around since the 1960s. They were made popular by the book titled <a href="http://www.eaipatterns.com/">Enterprise Integration Patterns</a>. Basically a <a href="http://www.eaipatterns.com/MessageBus.html">message bus</a> is all about <strong>decoupling producers and consumers</strong>.</p><p>The typical <strong>enterprise bus</strong> supports delivering, queueing, filtering, batching and persisting messages. Having a bus can also enable asynchronous message passing and greatly increase the producer performance as it can just send and forget. Performance is tipically highly tuneable by controlling the queue depth, the number of consumers and so on.</p><p>On mobile platforms we can use <strong>microbuses</strong>. In this environment producing a message is tipically a blocking operation and we don&apos;t get to fine tune as many things (like threading semantics) but they&apos;re still pretty useful.</p><p>On <strong>iOS</strong> there&apos;s <strong><a href="https://developer.apple.com/library/mac/documentation/cocoa/reference/foundation/Classes/NSNotificationCenter_Class/Reference/Reference.html">NSNotificationCenter</a></strong> which isn&apos;t that new and not that tunable (but e.g. batching is handled for us.) <strong>Android&apos;s <a href="http://developer.android.com/reference/android/support/v4/content/LocalBroadcastManager.html">LocalBroadcastManager</a></strong> is quite similar to Apple&apos;s solution and it&apos;s supported from early Android versions. Both platforms support local buses and have a global bus as well.</p><p>Another library to look at for <strong>Android</strong> is <strong><a href="http://square.github.io/otto/">Otto</a></strong> from Square (you know, the small square thingy to read credit cards and accept them with your mobile/tablet). It&apos;s forked from the <a href="https://code.google.com/p/guava-libraries/wiki/EventBusExplained">EventBus in Google&apos;s Guava library</a> but specialized for Android.</p><h2><a class="heading-anchor" name="functional-reactive-programming" href="#functional-reactive-programming">Functional reactive programming</a></h2><p>Maciej started with some great analogies to explain reactive programming. It&apos;s really difficult to find a good one. One of his examples was a simple spreadsheet. Imagine a cell with a function referencing another cell. When the value of the referenced cell changes then the original cell changes as well in <strong>reaction</strong> to the change.</p><p>Basically reactive programming is about <strong>treating events as first class citizen</strong>. What&apos;s even cooler is that a lot of the <strong>functional programming concepts and toolkit</strong> of filter/map... can be used here as well. Sometimes people also call this <strong>functional reactive programming</strong>.</p><p>The concept originates from <strong>Microsoft</strong> where they built <strong>Reactive Extension (RX)</strong> for C# then for JavaScript. So what do we get on mobile?</p><p><strong>Apple</strong> also has this thing called <strong><a href="https://developer.apple.com/library/mac/documentation/cocoa/conceptual/KeyValueObserving/KeyValueObserving.html">Key-Value Observing (KVO)</a></strong>. Basically it allows objects to be notified of changes to specified properties of other objects. KVO also supports returning an <strong>intial value</strong> (even before the first event is received) via NSKeyValueObservingOptionInitial. The observed property is specified as a string so it&apos;s not too refactoring friendly.</p><p><strong>Android</strong> can make use of <strong><a href="https://github.com/Netflix/RxJava">RxJava</a></strong> by Netflix which is the port of Microsoft&apos;s RX to Java (the project actually contains <a href="http://rxscala.github.io/">RxScala</a> as well). The key concept of this library is the <strong>Observable</strong> abstraction which can be imagined as an <strong>Iterable but with pushed values</strong>. It has greatly parametrizable concurrency which allows defining which thread to execute on (subcribeOn, observeOn). Since Java doesn&apos;t have lambdas yet -as Java 8 is still not released- the code might get a bit messy and verbose. <strong>In iOS</strong> apps we can also use <strong><a href="https://github.com/ReactiveCocoa/ReactiveCocoa">ReactiveCocoa</a></strong>. ReactiveCocoa and RxJava also allow <strong>composing and transforming streams</strong> of values and they&apos;re full-fledged functional reactive programming libraries.</p><p>Maciej then showed us -a not strictly mobile- example with <strong><a href="http://baconjs.github.io/">bacon.js</a></strong>. EventStream in bacon.js is analogous to Observavle in RX and this library also has a concept of a <strong>Property with current value</strong> which reacts on a stream of events. It works well with JavaScript promises but when I asked Maciej said that it&apos;s not integrated with WebWorkers yet.</p><p><a href="http://www.thoughtworks.com/radar/#/languages-and-frameworks/686">Reactive Extensions across languages</a> also made it to the trial ring of the latest <strong><a href="http://www.thoughtworks.com/radar/#/">ThoughtWorks Technology Radar</a></strong></p><h2><a class="heading-anchor" name="conclusion" href="#conclusion">Conclusion</a></h2><p>Maciej summed up that <strong>buses and reactive</strong> actually <strong>work well together</strong> and they&apos;re suited for <strong>different usecases</strong>.</p><p><strong>Buses</strong> are useful when <strong>broadcasting</strong> messages. They&apos;re a good fit for messaging <strong>between components</strong> but <strong>nothing really noisy</strong>.</p><p>The <strong>reactive</strong> approach probably works better on a <strong>smaller scale</strong> like <strong>within a class</strong>. It&apos;s good for <strong>composing local events</strong> and can handle a <strong>firehose</strong> of events.</p><h2><a class="heading-anchor" name="useful-tips" href="#useful-tips">Useful tips</a></h2><p>Then we got some useful tips on thing to watch out for. It&apos;s important to <strong>cleanup subscriptions</strong>. It&apos;s a good idea to <strong>signal the end of a stream</strong> somehow (e.g by sending a stream is over message - this shows some similarity to the poison pill message used in Akka to terminate actors). An interesting problem Maciej highlighted numerous times during the talk is how you handle <strong>events published before subscription</strong> or how you get <strong>initial values</strong> for mutable data modified by streams of messages.</p><p><img src="https://ga-beacon.appspot.com/UA-29212656-1/reactive-and-buses-for-mobile?pixel" alt=""></p></article></body></html>